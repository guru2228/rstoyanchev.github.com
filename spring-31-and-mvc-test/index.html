<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>Spring 3.1 and MVC Testing Support</title>

  <meta name="viewport" content="width=device-width"/>

  <link rel="stylesheet" href="./css/reset.css" type="text/css"/>
  <link rel="stylesheet" href="./css/showoff.css" type="text/css"/>

  <script type="text/javascript" src="./js/jquery-1.4.2.min.js"></script>
  <script type="text/javascript" src="./js/jquery.cycle.all.js"></script>
	<script type="text/javascript" src="./js/jquery-print.js"></script>
  <script type="text/javascript" src="./js/jquery.batchImageLoad.js"></script>

  <script type="text/javascript" src="./js/jquery.doubletap-0.1.js"></script>

  <script type="text/javascript" src="./js/fg.menu.js"></script>
  <script type="text/javascript" src="./js/showoff.js"></script>
  <script type="text/javascript" src="./js/jTypeWriter.js"> </script>
  <script type="text/javascript" src="./js/sh_main.min.js"></script>
  <script type="text/javascript" src="./js/core.js"></script>
  <script type="text/javascript" src="./js/showoffcore.js"></script>
  <script type="text/javascript" src="./js/coffee-script.js"></script>

  <link type="text/css" href="./css/fg.menu.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/theme/ui.all.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/sh_style.css" rel="stylesheet" >

  
    <link rel="stylesheet" href="file/style.css" type="text/css"/>
  

  

  <script type="text/javascript">
  $(function(){
      setupPreso(false, './');
  });
  </script>

</head>

<body>

<a tabindex="0" href="#search-engines" class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all" id="navmenu"><span class="ui-icon ui-icon-triangle-1-s"></span>slides</a>
<div id="navigation" class="hidden"></div>

<div id="help">
  <table>
    <tr><td class="key">z, ?</td><td>toggle help (this)</td></tr>
    <tr><td class="key">space, &rarr;</td><td>next slide</td></tr>
    <tr><td class="key">shift-space, &larr;</td><td>previous slide</td></tr>
    <tr><td class="key">d</td><td>toggle debug mode</td></tr>
    <tr><td class="key">## &lt;ret&gt;</td><td>go to slide #</td></tr>
    <tr><td class="key">c, t</td><td>table of contents (vi)</td></tr>
    <tr><td class="key">f</td><td>toggle footer</td></tr>
    <tr><td class="key">r</td><td>reload slides</td></tr>
    <tr><td class="key">n</td><td>toggle notes</td></tr>
    <tr><td class="key">p</td><td>run preshow</td></tr>
  </table>
</div>

<div class="buttonNav">
  <input type="submit" onClick="prevStep();" value="prev"/>
  <input type="submit" onClick="nextStep();" value="next"/>
</div>

<div id="preso">loading presentation...</div>
<div id="footer">
  <span id="slideInfo"></span>
  <span id="debugInfo"></span>
  <span id="notesInfo"></span>
</div>

<div id="slides" class="offscreen" style="display:none;">
<div class="slide" data-transition="none"><div class="content subsection" ref="intro/slides/1">
<h1><strong>Spring 3.1 and MVC Testing Support</strong></h1>

<br/>


<h2>Sam Brannen</h2>

<h3><em>Swiftmind</em></h3>

<br/>


<h2>Rossen Stoyanchev</h2>

<h3><em>SpringSource, VMware</em></h3>

<br/>


<h4>SpringOne 2GX</h4>

<h4>October 28, 2011</h4></div>
</div><div class="slide" data-transition="none"><div class="content small incremental" ref="intro/slides/2">
<h1><strong>Sam Brannen</strong></h1>

<ul>
<li>Senior Software Consultant @ Swiftmind</li>
<li>Java developer with 13+ years' experience</li>
<li>Spring Framework Core Developer</li>
<li>Lead author of <em>Spring in a Nutshell</em></li>
<li>Previous SpringSource dm Server&#x2122; developer</li>
<li>Presenter on Spring, Java, OSGi, and testing</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content small incremental" ref="intro/slides/3">
<h1><strong>Rossen Stoyanchev</strong></h1>

<ul>
<li>Staff Engineer SpringSource, VMware</li>
<li>Spring MVC, Spring Web Flow committer</li>
<li>Teach and consult, Spring Projects</li>
<li>Spring Web course author</li>
<li>NYC area</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content subsection incremental" ref="intro/slides/4">
<h1>Goals of the Presentation</h1>

<ul>
<li><em>Gain an overview of testing features in Spring 3.1</em></li>
<li><em>Learn about the new Spring MVC<br/> Test Support project</em></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content subsection incremental" ref="intro/slides/5">
<h1>Agenda</h1>

<ul>
<li>Spring TestContext Framework</li>
<li>Testing with @Configuration Classes</li>
<li>Testing with Environment Profiles</li>
<li>Spring MVC Test Support</li>
<li>Q&amp;A</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="intro/slides/6">
<h1>Show of Hands...</h1>

<ul>
<li>JUnit / TestNG</li>
<li>Spring 2.5 / 3.0 / 3.1</li>
<li>Integration testing with Spring</li>
<li>Spring TestContext Framework</li>
<li>Spring MVC</li>
<li>Spring MVC Test Support</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content subsection" ref="tcf/slides/1">
<h1>Spring TestContext Framework</h1></div>
</div><div class="slide" data-transition="none"><div class="content bullets center" ref="tcf/slides/2">
<ul>
<li>Introduced in Spring 2.5</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets center" ref="tcf/slides/3">
<ul>
<li>Revised in Spring 3.1</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets center" ref="tcf/slides/4">
<ul>
<li>Unit <em>and</em> integration testing</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets center" ref="tcf/slides/5">
<ul>
<li>Annotation-driven</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets center" ref="tcf/slides/6">
<ul>
<li>Convention over Configuration</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets center" ref="tcf/slides/7">
<ul>
<li>JUnit &amp; TestNG</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental small" ref="tcf/slides/8">
<h1>Spring &amp; Unit Testing</h1>

<ul>
<li>POJO-based programming model</li>
<li>Program to interfaces</li>
<li>IoC / Dependency Injection</li>
<li>Out-of-container testability</li>
<li>Testing mocks/stubs for various APIs: Servlet,  Portlet, JNDI</li>
<li>General purpose testing utilities

<ul>
<li><code>ReflectionTestUtils</code></li>
<li><code>ModelAndViewAssert</code></li>
</ul>
</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental small" ref="tcf/slides/9">
<h1>Spring &amp; Integration Testing</h1>

<ul>
<li><code>ApplicationContext</code> management &amp; caching</li>
<li>Dependency injection of test instances</li>
<li>Transactional test management

<ul>
<li>with default rollback semantics</li>
</ul>
</li>
<li><code>SimpleJdbcTestUtils</code></li>
<li>JUnit 3.8 support classes are deprecated as of Spring 3.0/3.1</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental smaller" ref="tcf/slides/10">
<h1>Spring Test Annotations</h1>

<ul>
<li>Application Contexts

<ul>
<li><code>@ContextConfiguration</code>, <code>@DirtiesContext</code></li>
</ul>
</li>
<li><code>@TestExecutionListeners</code></li>
<li>Dependency Injection

<ul>
<li><code>@Autowired</code>, <code>@Qualifier</code>, <code>@Inject</code>, &#x2026;</li>
</ul>
</li>
<li>Transactions

<ul>
<li><code>@Transactional</code>, <code>@TransactionConfiguration</code>, <code>@Rollback</code>, <code>@BeforeTransaction</code>, <code>@AfterTransaction</code></li>
</ul>
</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="tcf/slides/11">
<h1>Spring JUnit Annotations</h1>

<ul>
<li>Testing Profiles

<ul>
<li><em>groups, not bean definition profiles</em></li>
<li><code>@IfProfileValue</code>, <code>@ProfileValueSourceConfiguration</code></li>
</ul>
</li>
<li>JUnit extensions

<ul>
<li><code>@Timed</code>, <code>@Repeat</code></li>
</ul>
</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="tcf/slides/12">
<h1>Using the TestContext Framework</h1>

<ul>
<li>Use the <code>SpringJUnit4ClassRunner</code> for <strong>JUnit</strong> 4.5+</li>
<li>Instrument test class with <code>TestContextManager</code> for <strong>TestNG</strong></li>
<li>Extend one of the base classes

<ul>
<li><code>Abstract(Transactional)[JUnit4|TestNG]SpringContextTests</code></li>
</ul>
</li>
</ul>
</div>
</div><div class="slide" data-transition="fade"><div class="content small" ref="tcf/slides/13">
<h1>Example: @POJO Test Class</h1>

<pre class="sh_java"><code>



public class OrderServiceTests {










  @Test
  public void testOrderService() { &#x2026; }
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content small" ref="tcf/slides/14">
<h1>Example: @POJO Test Class</h1>

<pre class="sh_java"><code>@RunWith(SpringJUnit4ClassRunner.class)



public class OrderServiceTests {










  @Test
  public void testOrderService() { &#x2026; }
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content small" ref="tcf/slides/15">
<h1>Example: @POJO Test Class</h1>

<pre class="sh_java"><code>@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration


public class OrderServiceTests {










  @Test
  public void testOrderService() { &#x2026; }
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content small" ref="tcf/slides/16">
<h1>Example: @POJO Test Class</h1>

<pre class="sh_java"><code>@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration // defaults to
// OrderServiceTests-context.xml in same package

public class OrderServiceTests {










  @Test
  public void testOrderService() { &#x2026; }
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content small" ref="tcf/slides/17">
<h1>Example: @POJO Test Class</h1>

<pre class="sh_java"><code>@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration // defaults to
// OrderServiceTests-context.xml in same package

public class OrderServiceTests {

  @Autowired
  private OrderService orderService;







  @Test
  public void testOrderService() { &#x2026; }
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content small" ref="tcf/slides/18">
<h1>Example: @POJO Test Class</h1>

<pre class="sh_java"><code>@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration // defaults to
// OrderServiceTests-context.xml in same package
@Transactional
public class OrderServiceTests {

  @Autowired
  private OrderService orderService;







  @Test
  public void testOrderService() { &#x2026; }
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content small" ref="tcf/slides/19">
<h1>Example: @POJO Test Class</h1>

<pre class="sh_java"><code>@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration // defaults to
// OrderServiceTests-context.xml in same package
@Transactional
public class OrderServiceTests {

  @Autowired
  private OrderService orderService;

  @BeforeTransaction
  public void verifyInitialDatabaseState() { &#x2026; }




  @Test
  public void testOrderService() { &#x2026; }
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content small" ref="tcf/slides/20">
<h1>Example: @POJO Test Class</h1>

<pre class="sh_java"><code>@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration // defaults to
// OrderServiceTests-context.xml in same package
@Transactional
public class OrderServiceTests {

  @Autowired
  private OrderService orderService;

  @BeforeTransaction
  public void verifyInitialDatabaseState() { &#x2026; }

  @Before
  public void setUpTestDataWithinTransaction() { &#x2026; }

  @Test
  public void testOrderService() { &#x2026; }
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content subsection small" ref="tcf/slides/21">
<h1>Core Components</h1></div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="tcf/slides/22">
<h1><code>TestContext</code></h1>

<ul>
<li>Tracks context for current test</li>
<li>Delegates to a <code>ContextLoader</code></li>
<li>Caches <code>ApplicationContext</code></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="tcf/slides/23">
<h1><code>TestContextManager</code></h1>

<ul>
<li>Manages the <code>TestContext</code></li>
<li>Signals events to listeners:

<ul>
<li>before: <em>before-class methods</em></li>
<li>after: <em>test instantiation</em></li>
<li>before: <em>before methods</em></li>
<li>after: <em>after methods</em></li>
<li>after: <em>after-class methods</em></li>
</ul>
</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental small" ref="tcf/slides/24">
<h1><code>TestExecutionListener</code> SPI</h1>

<ul>
<li>Reacts to test execution events

<ul>
<li>Receives reference to current <code>TestContext</code></li>
</ul>
</li>
<li>Out of the box:

<ul>
<li><code>DependencyInjectionTestExecutionListener</code></li>
<li><code>DirtiesContextTestExecutionListener</code></li>
<li><code>TransactionalTestExecutionListener</code></li>
</ul>
</li>
</ul>
</div>
</div><div class="slide" data-transition="fade"><div class="content center small" ref="tcf/slides/25">
<h1><code>TestExecutionListener</code></h1>

<p><img src="./file/tcf/Testing-TEL-CD.png" alt="Testing-TEL-CD.png"/></p></div>
</div><div class="slide" data-transition="scrollUp"><div class="content center small" ref="tcf/slides/26">
<h1>TEL: <em>Prepare Instance</em></h1>

<p><img src="./file/tcf/Testing-TEL-SD-prepareTestInstance.png" alt="Testing-TEL-SD-prepareTestInstance.png"/></p></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content center small" ref="tcf/slides/27">
<h1>TEL: <em>Befores and Afters</em></h1>

<p><img src="./file/tcf/Testing-TEL-SD-befores-and-afters.png" alt="Testing-TEL-SD-befores-and-afters.png"/></p></div>
</div><div class="slide" data-transition="none"><div class="content incremental small" ref="tcf/slides/28">
<h1><code>ContextLoader</code> SPI</h1>

<ul>
<li>Strategy for loading application contexts

<ul>
<li>from resource locations</li>
</ul>
</li>
<li>Out of the box:

<ul>
<li><code>GenericXmlContextLoader</code></li>
<li><code>GenericPropertiesContextLoader</code></li>
</ul>
</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content center small" ref="tcf/slides/29">
<h1><code>ContextLoader</code> 2.5</h1>

<p><img src="./file/tcf/Testing-ContextLoader-CD-2.5.png" alt="Testing-ContextLoader-CD-2.5.png"/></p></div>
</div><div class="slide" data-transition="scrollUp"><div class="content center small" ref="tcf/slides/30">
<h1>Putting it all together</h1>

<p><img src="./file/tcf/Testing-TCF-CoreComponents.png" alt="Testing-TCF-CoreComponents.png"/></p></div>
</div><div class="slide" data-transition="scrollDown"><div class="content subsection" ref="new-in-3.1/slides/1">
<h1>New in Spring 3.1</h1></div>
</div><div class="slide" data-transition="none"><div class="content bullets center" ref="new-in-3.1/slides/2">
<ul>
<li>Support for ...</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets center" ref="new-in-3.1/slides/3">
<ul>
<li>testing with <code>@Configuration</code> classes</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets center" ref="new-in-3.1/slides/4">
<ul>
<li>and</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets center" ref="new-in-3.1/slides/5">
<ul>
<li>testing with <em>environment profiles</em></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets center" ref="new-in-3.1/slides/6">
<ul>
<li>made possible by ...</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets center" ref="new-in-3.1/slides/7">
<ul>
<li><code>SmartContextLoader</code></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets center" ref="new-in-3.1/slides/8">
<ul>
<li><code>AnnotationConfigContextLoader</code></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets center" ref="new-in-3.1/slides/9">
<ul>
<li><code>DelegatingSmartContextLoader</code></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets center" ref="new-in-3.1/slides/10">
<ul>
<li>updated context cache key generation</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="new-in-3.1/slides/11">
<h1><code>SmartContextLoader</code> SPI</h1>

<ul>
<li>Supersedes <code>ContextLoader</code></li>
<li>Strategy for loading application contexts</li>
<li>From <code>@Configuration</code> classes <em>or</em> resource locations</li>
<li>Supports environment profiles</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="new-in-3.1/slides/12">
<h1>Implementations</h1>

<ul>
<li><code>GenericXmlContextLoader</code></li>
<li><code>GenericPropertiesContextLoader</code></li>
<li><code>AnnotationConfigContextLoader</code></li>
<li><code>DelegatingSmartContextLoader</code></li>
</ul>
</div>
</div><div class="slide" data-transition="fade"><div class="content center small" ref="new-in-3.1/slides/13">
<h1><code>ContextLoader</code> 2.5</h1>

<p><img src="./file/new-in-3.1/Testing-ContextLoader-CD-2.5.png" alt="Testing-ContextLoader-CD-2.5.png"/></p></div>
</div><div class="slide" data-transition="fade"><div class="content center small" ref="new-in-3.1/slides/14">
<h1><code>ContextLoader</code> 3.1</h1>

<p><img src="./file/new-in-3.1/Testing-ContextLoader-CD-3.1.png" alt="Testing-ContextLoader-CD-3.1.png"/></p></div>
</div><div class="slide" data-transition="none"><div class="content subsection" ref="new-in-3.1/slides/15">
<h1>Testing with<br/> @Configuration Classes</h1></div>
</div><div class="slide" data-transition="none"><div class="content" ref="new-in-3.1/slides/16">
<h1><code>@ContextConfiguration</code></h1>

<p>accepts a new <code>classes</code> attribute...</p></div>
</div><div class="slide" data-transition="none"><div class="content" ref="new-in-3.1/slides/17">
<pre class="sh_java"><code>
@ContextConfiguration(
    classes={DataAccessConfig.class,
             ServiceConfig.class})</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content bullets center" ref="new-in-3.1/slides/18">
<ul>
<li>First, a review with XML config for comparison...</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content code small" ref="new-in-3.1/slides/19">
<h1><code>OrderServiceTest-context.xml</code></h1>

<pre class="sh_xml"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans ...&gt;

  &lt;!-- will be injected into OrderServiceTest --&gt;
  &lt;bean id="orderService"
      class="com.example.OrderServiceImpl"&gt;
    &lt;!-- set properties, etc. --&gt;
  &lt;/bean&gt;

  &lt;!-- other beans --&gt;

&lt;/beans&gt;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content code small" ref="new-in-3.1/slides/20">
<h1><code>OrderServiceTest.java</code></h1>

<pre class="sh_java"><code>package com.example;

@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration
public class OrderServiceTest {

    @Autowired
    private OrderService orderService;

    @Test
    public void testOrderService() {
        // test the orderService
    }
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content bullets center" ref="new-in-3.1/slides/21">
<ul>
<li>Let's rework that example to use a <code>@Configuration</code> class and the new <code>AnnotationConfigContextLoader</code>...</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content code smaller" ref="new-in-3.1/slides/22">
<h1><code>OrderServiceTest.java</code></h1>

<pre class="sh_java"><code>@RunWith(SpringJUnit4ClassRunner.class)


public class OrderServiceTest {












  @Autowired
  private OrderService orderService;
  // @Test methods ...
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content code smaller" ref="new-in-3.1/slides/23">
<h1><code>OrderServiceTest.java</code></h1>

<pre class="sh_java"><code>@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(
    loader=AnnotationConfigContextLoader.class)
public class OrderServiceTest {












  @Autowired
  private OrderService orderService;
  // @Test methods ...
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content code smaller" ref="new-in-3.1/slides/24">
<h1><code>OrderServiceTest.java</code></h1>

<pre class="sh_java"><code>@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration
public class OrderServiceTest {












  @Autowired
  private OrderService orderService;
  // @Test methods ...
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content code smaller" ref="new-in-3.1/slides/25">
<h1><code>OrderServiceTest.java</code></h1>

<pre class="sh_java"><code>@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration
public class OrderServiceTest {

  @Configuration
  static class Config {







  }

  @Autowired
  private OrderService orderService;
  // @Test methods ...
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content code smaller" ref="new-in-3.1/slides/26">
<h1><code>OrderServiceTest.java</code></h1>

<pre class="sh_java"><code>@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration
public class OrderServiceTest {

  @Configuration
  static class Config {

    @Bean // will be injected into OrderServiceTest
    public OrderService orderService() {
      OrderService orderService = new OrderServiceImpl();
      // set properties, etc.
      return orderService;
    }
  }

  @Autowired
  private OrderService orderService;
  // @Test methods ...
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="new-in-3.1/slides/27">
<h1>What's changed?</h1>

<ul>
<li>No XML</li>
<li>Bean definitions are converted to Java

<ul>
<li>using <code>@Configuration</code> and <code>@Bean</code></li>
</ul>
</li>
<li>Otherwise, the test remains unchanged</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets center" ref="new-in-3.1/slides/28">
<ul>
<li>But what if we don't want a static inner <code>@Configuration</code> class?</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets center" ref="new-in-3.1/slides/29">
<ul>
<li>Just externalize the config...</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content code smaller" ref="new-in-3.1/slides/30">
<h1><code>OrderServiceConfig.java</code></h1>

<pre class="sh_java"><code>@Configuration
public class OrderServiceConfig {

  @Bean // will be injected into OrderServiceTest
  public OrderService orderService() {
    OrderService orderService = new OrderServiceImpl();
    // set properties, etc.
    return orderService;
  }
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content bullets center" ref="new-in-3.1/slides/31">
<ul>
<li>And reference the config classes in <code>@ContextConfiguration</code>...</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content code smaller" ref="new-in-3.1/slides/32">
<h1><code>OrderServiceConfig.java</code></h1>

<pre class="sh_java"><code>@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(classes=OrderServiceConfig.class)
public class OrderServiceTest {

  @Autowired
  private OrderService orderService;

  @Test
  public void testOrderService() {
    // test the orderService
  }
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="new-in-3.1/slides/33">
<h1>@Configuration + XML</h1>

<ul>
<li><strong>Q</strong>: How can we combine <code>@Configuration</code> classes with XML config?</li>
<li><strong>A</strong>: Choose one as the <em>entry point</em>.</li>
<li><em>That's how it works in production anyway</em></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="new-in-3.1/slides/34">
<h1>Importing Configuration</h1>

<ul>
<li>In XML:

<ul>
<li>include <code>@Configuration</code> classes via component scanning</li>
<li>or define them as normal Spring beans</li>
</ul>
</li>
<li>In an <code>@Configuration</code> class:

<ul>
<li>use <code>@ImportResource</code> to import XML config files</li>
</ul>
</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content subsection" ref="new-in-3.1/slides/35">
<h1>Testing with<br/> Environment Profiles</h1></div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="new-in-3.1/slides/36">
<h1>@ActiveProfiles</h1>

<p>To activate <em>bean definition profiles</em> in tests...</p>

<ul>
<li>Annotate a test class with <code>@ActiveProfiles</code></li>
<li>Supply a list of profiles to be activated for the test</li>
<li>Can be used with <code>@Configuration</code> classes and XML config</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets center" ref="new-in-3.1/slides/37">
<ul>
<li>Let's look at an example with XML config...</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content code smaller" ref="new-in-3.1/slides/38">
<h1><code>app-config.xml</code> (1/2)</h1>

<pre class="sh_xml"><code>&lt;beans ... &gt;

    &lt;bean id="transferService"
        class="com.example.DefaultTransferService"&gt;
        &lt;constructor-arg ref="accountRepository"/&gt;
        &lt;constructor-arg ref="feePolicy"/&gt;
    &lt;/bean&gt;

    &lt;bean id="accountRepository"
        class="com.example.JdbcAccountRepository"&gt;
        &lt;constructor-arg ref="dataSource"/&gt;
    &lt;/bean&gt;

    &lt;bean id="feePolicy"
        class="com.example.ZeroFeePolicy"/&gt;

    &lt;!-- dataSource --&gt;

&lt;/beans&gt;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content code smaller" ref="new-in-3.1/slides/39">
<h1><code>app-config.xml</code> (2/2)</h1>

<pre class="sh_xml"><code>&lt;beans ... &gt;

    &lt;!-- transferService, accountRepository, feePolicy --&gt;















&lt;/beans&gt;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content code smaller" ref="new-in-3.1/slides/40">
<h1><code>app-config.xml</code> (2/2)</h1>

<pre class="sh_xml"><code>&lt;beans ... &gt;

    &lt;!-- transferService, accountRepository, feePolicy --&gt;

    &lt;beans profile="production"&gt;
        &lt;jee:jndi-lookup id="dataSource"
            jndi-name="java:comp/env/jdbc/datasource"/&gt;
    &lt;/beans&gt;










&lt;/beans&gt;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content code smaller" ref="new-in-3.1/slides/41">
<h1><code>app-config.xml</code> (2/2)</h1>

<pre class="sh_xml"><code>&lt;beans ... &gt;

    &lt;!-- transferService, accountRepository, feePolicy --&gt;

    &lt;beans profile="production"&gt;
        &lt;jee:jndi-lookup id="dataSource"
            jndi-name="java:comp/env/jdbc/datasource"/&gt;
    &lt;/beans&gt;

    &lt;beans profile="dev"&gt;
        &lt;jdbc:embedded-database id="dataSource"&gt;
            &lt;jdbc:script
                location="classpath:schema.sql"/&gt;
            &lt;jdbc:script
                location="classpath:test-data.sql"/&gt;
        &lt;/jdbc:embedded-database&gt;
    &lt;/beans&gt;

&lt;/beans&gt;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content code smaller" ref="new-in-3.1/slides/42">
<h1><code>TransferServiceTest.java</code></h1>

<pre class="sh_java"><code>@RunWith(SpringJUnit4ClassRunner.class)


public class TransferServiceTest {

    @Autowired
    private TransferService transferService;

    @Test
    public void testTransferService() {
        // test the transferService
    }
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content code smaller" ref="new-in-3.1/slides/43">
<h1><code>TransferServiceTest.java</code></h1>

<pre class="sh_java"><code>@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration("/app-config.xml")

public class TransferServiceTest {

    @Autowired
    private TransferService transferService;

    @Test
    public void testTransferService() {
        // test the transferService
    }
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content code smaller" ref="new-in-3.1/slides/44">
<h1><code>TransferServiceTest.java</code></h1>

<pre class="sh_java"><code>@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration("/app-config.xml")
@ActiveProfiles("dev")
public class TransferServiceTest {

    @Autowired
    private TransferService transferService;

    @Test
    public void testTransferService() {
        // test the transferService
    }
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content bullets center" ref="new-in-3.1/slides/45">
<ul>
<li>And now an example with <code>@Configuration</code> classes</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content code smaller" ref="new-in-3.1/slides/46">
<h1><code>TransferServiceConfig.java</code></h1>

<pre class="sh_java"><code>@Configuration
public class TransferServiceConfig {

  @Autowired DataSource dataSource;

  @Bean
  public TransferService transferService() {
    return new DefaultTransferService(accountRepository(),
      feePolicy());
  }

  @Bean
  public AccountRepository accountRepository() {
    return new JdbcAccountRepository(dataSource);
  }

  @Bean
  public FeePolicy feePolicy() {
    return new ZeroFeePolicy();
  }
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content code smaller" ref="new-in-3.1/slides/47">
<h1><code>JndiDataConfig.java</code></h1>

<pre class="sh_java"><code>@Configuration
@Profile("production")
public class JndiDataConfig {

  @Bean
  public DataSource dataSource() throws Exception {
    Context ctx = new InitialContext();
    return (DataSource)
      ctx.lookup("java:comp/env/jdbc/datasource");
  }
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content code smaller" ref="new-in-3.1/slides/48">
<h1><code>StandaloneDataConfig.java</code></h1>

<pre class="sh_java"><code>@Configuration
@Profile("dev")
public class StandaloneDataConfig {

  @Bean
  public DataSource dataSource() {
    return new EmbeddedDatabaseBuilder()
      .setType(EmbeddedDatabaseType.HSQL)
      .addScript("classpath:schema.sql")
      .addScript("classpath:test-data.sql")
      .build();
  }
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content bullets center" ref="new-in-3.1/slides/49">
<ul>
<li>And finally the test class...</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content code smaller" ref="new-in-3.1/slides/50">
<h1><code>TransferServiceTest.java</code></h1>

<pre class="sh_java"><code>package com.bank.service;

@RunWith(SpringJUnit4ClassRunner.class)






public class TransferServiceTest {

    @Autowired
    private TransferService transferService;

    @Test
    public void testTransferService() {
        // test the transferService
    }
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content code smaller" ref="new-in-3.1/slides/51">
<h1><code>TransferServiceTest.java</code></h1>

<pre class="sh_java"><code>package com.bank.service;

@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(
    classes={
        TransferServiceConfig.class,
        StandaloneDataConfig.class,
        JndiDataConfig.class})

public class TransferServiceTest {

    @Autowired
    private TransferService transferService;

    @Test
    public void testTransferService() {
        // test the transferService
    }
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content code smaller" ref="new-in-3.1/slides/52">
<h1><code>TransferServiceTest.java</code></h1>

<pre class="sh_java"><code>package com.bank.service;

@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(
    classes={
        TransferServiceConfig.class,
        StandaloneDataConfig.class,
        JndiDataConfig.class})
@ActiveProfiles("dev")
public class TransferServiceTest {

    @Autowired
    private TransferService transferService;

    @Test
    public void testTransferService() {
        // test the transferService
    }
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content incremental small" ref="new-in-3.1/slides/53">
<h1>Active Profile Inheritance</h1>

<ul>
<li><code>@ActiveProfiles</code> supports <em>inheritance</em> as well</li>
<li>Via the <code>inheritProfiles</code> attribute</li>
<li>See Javadoc for an example</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content subsection" ref="new-in-3.1/slides/54">
<h1>ApplicationContext Caching</h1></div>
</div><div class="slide" data-transition="none"><div class="content bullets center" ref="new-in-3.1/slides/55">
<ul>
<li>Until Spring 3.1</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets center" ref="new-in-3.1/slides/56">
<ul>
<li>application contexts were cached</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets center" ref="new-in-3.1/slides/57">
<ul>
<li>but using only resource locations for the key.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets center" ref="new-in-3.1/slides/58">
<ul>
<li>Now there are different requirements...</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental small" ref="new-in-3.1/slides/59">
<h1>New Key Generation Algorithm</h1>

<p>The context cache key generation algorithm has been updated to include...</p>

<ul>
<li><strong>locations</strong> <em>(from <code>@ContextConfiguration</code>)</em></li>
<li><strong>classes</strong> <em>(from <code>@ContextConfiguration</code>)</em></li>
<li><strong>contextLoader</strong> <em>(from <code>@ContextConfiguration</code>)</em></li>
<li><strong>activeProfiles</strong> <em>(from <code>@ActiveProfiles</code>)</em></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollUp"><div class="content incremental small" ref="new-in-3.1/slides/60">
<h1>Summary</h1>

<ul>
<li>The <em>Spring TestContext Framework</em> simplifies integration testing of Spring-based applications</li>
<li>Spring 3.1 provides first-class testing support for:

<ul>
<li><code>@Configuration</code> classes</li>
<li>Environment profiles</li>
</ul>
</li>
<li>See the <a href="http://blog.springsource.com/2011/06/21/spring-3-1-m2-testing-with-configuration-classes-and-profiles/">Testing with @Configuration Classes and Profiles</a> blog for further insight</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content subsection" ref="mvc/slides/1">
<h1>Spring MVC Test Support</h1></div>
</div><div class="slide" data-transition="none"><div class="content" ref="mvc/slides/2">
<h1>How Do To Test an <code>@Controller</code>?</h1></div>
</div><div class="slide" data-transition="none"><div class="content smaller" ref="mvc/slides/3">
<pre class="sh_java"><code>
@Controller
@RequestMapping("/accounts")
public class AccountController {

 // ...

    @ModelAttribute
    public Account getAccount(String number) {
        return this.accountManager.getAccount(number);
    }

    @RequestMapping(method = RequestMethod.POST)
    public String save(@Valid Account account, 
                        BindingResult result) {
        if (result.hasErrors()) {
            return "accounts/edit";
        }
        this.accountManager.saveOrUpdate(account);
        return "redirect:accounts";
    }

}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="mvc/slides/4">
<h1>Unit Test?</h1>

<ul>
<li>Create controller instance</li>
<li>Mock or stub services &amp; repositories</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content smaller" ref="mvc/slides/5">
<h1>Example</h1>

<pre class="sh_java"><code>
@Test
public void testSave() {

    Account account = new Account();
    BindingResult result = 
        new BeanPropertyBindingResult(account, "account");











}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content smaller" ref="mvc/slides/6">
<h1>Example</h1>

<pre class="sh_java"><code>
@Test
public void testSave() {

    Account account = new Account();
    BindingResult result = 
        new BeanPropertyBindingResult(account, "account");

    AccountManager mgr = createMock(AccountManager.class);
    mgr.saveOrUpdate(account);
    replay(mgr);







}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content smaller" ref="mvc/slides/7">
<h1>Example</h1>

<pre class="sh_java"><code>
@Test
public void testSave() {

    Account account = new Account();
    BindingResult result = 
        new BeanPropertyBindingResult(account, "account");

    AccountManager mgr = createMock(AccountManager.class);
    mgr.saveOrUpdate(account);
    replay(mgr);

    AccountController contrlr = new AccountController(mgr);

    String view = contrlr.save(account, result);



}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content smaller" ref="mvc/slides/8">
<h1>Example</h1>

<pre class="sh_java"><code>
@Test
public void testSave() {

    Account account = new Account();
    BindingResult result = 
        new BeanPropertyBindingResult(account, "account");

    AccountManager mgr = createMock(AccountManager.class);
    mgr.saveOrUpdate(account);
    replay(mgr);

    AccountController contrlr = new AccountController(mgr);

    String view = contrlr.save(account, result);

    assertEquals("redirect:accounts", view);
    verify(mgr);
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content smaller" ref="mvc/slides/9">
<h1>Example With Failure</h1>

<pre class="sh_java"><code>
@Test
public void testSave() {

    Account account = new Account();
    BindingResult result = 
        new BeanPropertyBindingResult(account, "account");

    result.reject("error.code", "default message")










}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content smaller" ref="mvc/slides/10">
<h1>Example With Failure</h1>

<pre class="sh_java"><code>
@Test
public void testSave() {

    Account account = new Account();
    BindingResult result = 
        new BeanPropertyBindingResult(account, "account");

    result.reject("error.code", "default message")

    AccountManager mgr = createMock(AccountManager.class);
    replay(mgr);







}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content smaller" ref="mvc/slides/11">
<h1>Example With Failure</h1>

<pre class="sh_java"><code>
@Test
public void testSave() {

    Account account = new Account();
    BindingResult result = 
        new BeanPropertyBindingResult(account, "account");

    result.reject("error.code", "default message")

    AccountManager mgr = createMock(AccountManager.class);
    replay(mgr);

    AccountController contrlr = new AccountController(mgr);

    String view = contrlr.save(account, result);

    assertEquals("accounts/edit", view);
    verify(mgr);
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content incremental bullets" ref="mvc/slides/12">
<h1>Not Fully Tested</h1>

<ul>
<li>Request mappings</li>
<li>Binding errors</li>
<li>Type conversion</li>
<li>Etc.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental bullets" ref="mvc/slides/13">
<h1>Integration Test?</h1>

<ul>
<li>Selenium</li>
<li>JWebUnit</li>
<li>etc.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental bullets" ref="mvc/slides/14">
<h1>It Requires..</h1>

<ul>
<li>A running servlet container</li>
<li>More time to execute</li>
<li>More effort to maintain</li>
<li>Server is a black box</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="mvc/slides/15">
<h1>Actually...</h1></div>
</div><div class="slide" data-transition="none"><div class="content incremental bullets" ref="mvc/slides/16">
<h1>it's an end-to-end test</h1></div>
</div><div class="slide" data-transition="none"><div class="content incremental bullets" ref="mvc/slides/17">
<h1>the only way to verify..</h1>

<ul>
<li>Client-side behavior</li>
<li>Interaction with other server instances</li>
<li>Redis, Rabbit, etc.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental bullets" ref="mvc/slides/18">
<h1>We'd also like to..</h1>

<ul>
<li>Test controllers once!</li>
<li>Fully &amp; quickly</li>
<li>Execute tests often</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental bullets" ref="mvc/slides/19">
<h1>In summary..</h1>

<ul>
<li>We can't replace the need for end-to-end tests</li>
<li>But we can minimize errors</li>
<li>Have confidence in @MVC code</li>
<li>During end-to-end tests</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental bullets" ref="mvc/slides/20">
<h1>Spring MVC Test</h1>

<ul>
<li>Built on <code>spring-test</code></li>
<li>No Servlet container</li>
<li>Drives Spring MVC infrastructure</li>
<li>Both server &amp; client-side test support <br> (i.e. <code>RestTemplate</code> code)</br>
<li><em>Inspired by <code>spring-ws-test</code></em></li>
</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental bullets" ref="mvc/slides/21">
<h1>The Approach</h1>

<ul>
<li>Re-use controller test fixtures</li>
<li>I.e. mocked services &amp; repositories</li>
<li>Invoke <code>@Controller</code> classes through @MVC infrastructure</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content small" ref="mvc/slides/22">
<h1>Example</h1>

<pre class="sh_java"><code>
String contextLoc = "classpath:appContext.xml";
String warDir = "src/main/webapp";

MockMvc mockMvc =
  xmlConfigSetup(contextLoc)
    .configureWebAppRootDir(warDir, false)
    .build();

mockMvc.perform(post("/persons"))
  .andExpect(response().status().isOk())
  .andExpect(response().forwardedUrl("/add.jsp"))
  .andExpect(model().size(1))
  .andExpect(model().hasAttributes("person"));</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content incremental bullets" ref="mvc/slides/23">
<h1>Under the Covers</h1>

<ul>
<li>Mock <code>request/response</code> from <code>spring-test</code></li>
<li><code>DispatcherServlet</code> replacement</li>
<li>Multiple ways to initialize MVC infrastructure</li>
<li>Save results for expectations</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental bullets" ref="mvc/slides/24">
<h1>Ways To Initialize MVC Infrastructure</h1></div>
</div><div class="slide" data-transition="none"><div class="content small" ref="mvc/slides/25">
<h1>From Existing XML Config</h1>

<pre class="sh_java"><code>
// XML config

MockMvc mockMvc = 
    xmlConfigSetup("classpath:appContext.xml")
      .activateProfiles(..)
      .configureWebAppRootDir(warDir, false)
      .build();</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content small" ref="mvc/slides/26">
<h1>From Existing Java Config</h1>

<pre class="sh_java"><code>
// Java config

MockMvc mockMvc = 
    annotationConfigSetup(WebConfig.class)
      .activateProfiles(..)
      .configureWebAppRootDir(warDir, false)
      .build();</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content small" ref="mvc/slides/27">
<h1>Manually</h1>

<pre class="sh_java"><code>
    MockMvc mockMvc =
        standaloneSetup(new PersonController())
          .setMessageConverters(..)
          .setValidator(..)
          .setConversionService(..)
          .addInterceptors(..)
          .setViewResolvers(..)
          .setLocaleResolver(..)
          .build();</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content incremental bullets" ref="mvc/slides/28">
<h1>About Manual Setup</h1>

<ul>
<li>MVC components instantiated directly</li>
<li>Not looked up in Spring context</li>
<li>Focused, readable tests</li>
<li>But must verify MVC config separately</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental bullets smaller" ref="mvc/slides/29">
<h1><code>TestContext</code> Framework Example</h1>

<pre class="sh_java"><code>
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(
        locations={"/org/example/servlet-context.xml"})
public class TestContextTests {

  @Autowired
  private WebApplicationContext wac;

  @Before
  public void setup() {
    MockMvc mockMvc = 
        MockMvcBuilders.webApplicationContextSetup(this.wac)
          .build();
  }

}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content incremental bullets" ref="mvc/slides/30">
<h1><code>TestContext</code> Framework</h1>

<ul>
<li>Caches loaded Spring configuration</li>
<li>Potentially across all tests!</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental bullets" ref="mvc/slides/31">
<h1>However..</h1>

<ul>
<li><code>WebApplicationContext</code> not supported yet</li>
<li><a href="http://jira.springframework.org/browse/SPR-5243">To be supported</a> in Spring 3.2</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental bullets" ref="mvc/slides/32">
<h1>In the mean time..</h1>

<ul>
<li>You can use a custom <code>ContextLoader</code></li>
<li><a href="https://github.com/SpringSource/spring-test-mvc/blob/master/src/test/java/org/springframework/test/web/server/samples/context/TestContextTests.java">Example exists</a> in <code>spring-test-mvc</code></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental bullets" ref="mvc/slides/33">
<h1>Step 1</h1>

<ul>
<li>Add static imports</li>
<li><code>MockMvcBuilders.*</code></li>
<li><code>MockMvcRequestBuilders.*</code></li>
<li><code>MockMvcResultActions.*</code></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental bullets" ref="mvc/slides/34">
<h1>Easy to remember..</h1>

<ul>
<li><code>MockMvc*</code></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental bullets" ref="mvc/slides/35">
<h1>Also in Eclipse..</h1>

<ul>
<li>Add <code>MockMvc*</code> classes in <em>Preferences</em></li>
<li><em>Java -&gt; Editor -&gt; Favorites</em></li>
<li>Helps content assist</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content smaller" ref="mvc/slides/36">
<h1>Step 2</h1>

<h2>Initialize MVC infrastructure</h2>

<pre class="sh_java"><code>
String contextLoc = "classpath:appContext.xml";
String warDir = "src/main/webapp";

MockMvc mockMvc = xmlConfigSetup("classpath:appContext.xml")
    .configureWebAppRootDir(warDir, false)
    .build()









// ...</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content smaller" ref="mvc/slides/37">
<h1>Step 3</h1>

<h2>Build Request</h2>

<pre class="sh_java"><code>
String contextLoc = "classpath:appContext.xml";
String warDir = "src/main/webapp";

MockMvc mockMvc = xmlConfigSetup("classpath:appContext.xml")
    .configureWebAppRootDir(warDir, false)
    .build()

mockMvc.perform(get("/").accept(MediaType.APPLICATION_XML))







// ...</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content smaller" ref="mvc/slides/38">
<h1>Step 4</h1>

<h2>Add Expectations</h2>

<pre class="sh_java"><code>
String contextLoc = "classpath:appContext.xml";
String warDir = "src/main/webapp";

MockMvc mockMvc = xmlConfigSetup("classpath:appContext.xml")
    .configureWebAppRootDir(warDir, false)
    .build()

mockMvc.perform(get("/").accept(MediaType.APPLICATION_XML))
      .andExpect(response().status().isOk())
      .andExpect(response().contentType(MediaType))
      .andExpect(response().content().xpath(String).exists())
      .andExpect(response().redirectedUrl(String))
      .andExpect(model().hasAttributes(String...));


// ...</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content smaller" ref="mvc/slides/39">
<h1>Step 5</h1>

<h2>Debug</h2>

<pre class="sh_java"><code>
String contextLoc = "classpath:appContext.xml";
String warDir = "src/main/webapp";

MockMvc mockMvc = xmlConfigSetup("classpath:appContext.xml")
    .configureWebAppRootDir(warDir, false)
    .build()

mockMvc.perform(get("/").accept(MediaType.APPLICATION_XML))
      .andPrint(toConsole());






// ...</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content code" ref="mvc/slides/40">
<h1>Demo</h1>

<p><a href="https://github.com/SpringSource/spring-test-mvc">https://github.com/SpringSource/spring-test-mvc</a></p>

<p><strong>Sample Tests:</strong><br>
<a href="https://github.com/SpringSource/spring-test-mvc/tree/master/src/test/java/org/springframework/test/web/server/samples">org.springframework.test.web.server.samples</a></br></p>
</div>
</div><div class="slide" data-transition="none"><div class="content small" ref="mvc/slides/41">
<h1>Client-Side Example</h1>

<pre class="sh_java"><code>
RestTemplate restTemplate = ... ;

MockRestServiceServer.createServer(restTemplate)
    .expect(requestTo(String))
    .andExpect(method(HttpMethod))
    .andExpect(body(String))
    .andExpect(headerContains(String, String))
    .andRespond(withResponse(String, HttpHeaders));</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content incremental bullets small" ref="mvc/slides/42">
<h1>Project Availability</h1>

<ul>
<li><a href="github.com/SpringSource/spring-test-mvc"><code>github.com/SpringSource/spring-test-mvc</code></a></li>
<li>Request for feedback!</li>
<li>Send comments</li>
<li>Pull requests</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental bullets smaller" ref="mvc/slides/43">
<h1>Nightly Snapshot Available</h1>

<pre class="sh_xml"><code>
&lt;repository&gt;
    &lt;id&gt;org.springframework.maven.snapshot&lt;/id&gt;
    &lt;name&gt;Spring Maven Snapshot Repository&lt;/name&gt;
    &lt;url&gt;http://maven.springframework.org/snapshot&lt;/url&gt;
    &lt;releases&gt;
        &lt;enabled&gt;false&lt;/enabled&gt;
    &lt;/releases&gt;
    &lt;snapshots&gt;
        &lt;enabled&gt;true&lt;/enabled&gt;
    &lt;/snapshots&gt;
&lt;/repository&gt;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content subsection" ref="end/slides/1">
<h1>In Closing ...</h1></div>
</div><div class="slide" data-transition="none"><div class="content small" ref="end/slides/2">
<h1>Resources &#x2013; Spring MVC Test</h1>

<ul>
<li><strong>Project Home</strong>:<br/><a href="https://github.com/SpringSource/spring-test-mvc">https://github.com/SpringSource/spring-test-mvc</a></li>
<li><strong>Sample Tests</strong>:<br/><a href="https://github.com/SpringSource/spring-test-mvc/tree/master/src/test/java/org/springframework/test/web/server/samples">org.springframework.test.web.server.samples</a></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental small" ref="end/slides/3">
<h1>Resources &#x2013; Core Spring</h1>

<ul>
<li><strong>Spring Framework</strong>:<br/><a href="http://www.springsource.org/spring-core">http://www.springsource.org/spring-core</a></li>
<li><strong>Reference Manual</strong>: <a href="http://static.springsource.org/spring/docs/3.1.0.RC1/spring-framework-reference/html/">Spring 3.1 RC1</a></li>
<li><strong>Forums</strong>: <a href="http://forum.springframework.org">http://forum.springframework.org</a></li>
<li><strong>JIRA</strong>: <a href="https://jira.springsource.org">https://jira.springsource.org</a></li>
<li><strong><a href="http://shop.oreilly.com/product/9780596801946.do">Spring in a Nutshell</a></strong> &#x2026; <em>available in 2012</em></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content subsection" ref="end/slides/4">
<h1>Q&amp;A</h1>

<br/>


<h2>Sam Brannen</h2>

<h3>Web: <a href="http://www.swiftmind.com">Swiftmind.com</a></h3>

<h3>Twitter: <a href="http://twitter.com/sam_brannen">@sam_brannen</a></h3>

<br/>


<h2>Rossen Stoyanchev</h2>

<h3>Web: <a href="http://www.springsource.com">SpringSource.com</a></h3>

<h3>Twitter: <a href="http://twitter.com/rstoya05">@rstoya05</a></h3></div>
</div></div>

</body>
</html>
