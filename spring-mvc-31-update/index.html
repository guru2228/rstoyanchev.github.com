<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>Spring MVC 3.1 Update</title>

  <meta name="viewport" content="width=device-width"/>

  <link rel="stylesheet" href="./css/reset.css" type="text/css"/>
  <link rel="stylesheet" href="./css/showoff.css" type="text/css"/>

  <script type="text/javascript" src="./js/jquery-1.4.2.min.js"></script>
  <script type="text/javascript" src="./js/jquery.cycle.all.js"></script>
	<script type="text/javascript" src="./js/jquery-print.js"></script>
  <script type="text/javascript" src="./js/jquery.batchImageLoad.js"></script>

  <script type="text/javascript" src="./js/jquery.doubletap-0.1.js"></script>

  <script type="text/javascript" src="./js/fg.menu.js"></script>
  <script type="text/javascript" src="./js/showoff.js"></script>
  <script type="text/javascript" src="./js/jTypeWriter.js"> </script>
  <script type="text/javascript" src="./js/sh_main.min.js"></script>
  <script type="text/javascript" src="./js/core.js"></script>
  <script type="text/javascript" src="./js/showoffcore.js"></script>
  <script type="text/javascript" src="./js/coffee-script.js"></script>

  <link type="text/css" href="./css/fg.menu.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/theme/ui.all.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/sh_style.css" rel="stylesheet" >

  

  

  <script type="text/javascript">
  $(function(){
      setupPreso(false, './');
  });
  </script>

</head>

<body>

<a tabindex="0" href="#search-engines" class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all" id="navmenu"><span class="ui-icon ui-icon-triangle-1-s"></span>slides</a>
<div id="navigation" class="hidden"></div>

<div id="help">
  <table>
    <tr><td class="key">z, ?</td><td>toggle help (this)</td></tr>
    <tr><td class="key">space, &rarr;</td><td>next slide</td></tr>
    <tr><td class="key">shift-space, &larr;</td><td>previous slide</td></tr>
    <tr><td class="key">d</td><td>toggle debug mode</td></tr>
    <tr><td class="key">## &lt;ret&gt;</td><td>go to slide #</td></tr>
    <tr><td class="key">c, t</td><td>table of contents (vi)</td></tr>
    <tr><td class="key">f</td><td>toggle footer</td></tr>
    <tr><td class="key">r</td><td>reload slides</td></tr>
    <tr><td class="key">n</td><td>toggle notes</td></tr>
    <tr><td class="key">p</td><td>run preshow</td></tr>
  </table>
</div>

<div class="buttonNav">
  <input type="submit" onClick="prevStep();" value="prev"/>
  <input type="submit" onClick="nextStep();" value="next"/>
</div>

<div id="preso">loading presentation...</div>
<div id="footer">
  <span id="slideInfo"></span>
  <span id="debugInfo"></span>
  <span id="notesInfo"></span>
</div>

<div id="slides" class="offscreen" style="display:none;">
<div class="slide" data-transition="none"><div class="content subsection" ref="intro/slides/1">
<h1><strong>Spring MVC 3.1 Update</strong></h1>

<h2>Rossen Stoyanchev</h2>

<h3><em>SpringSource, VMware</em></h3></div>
</div><div class="slide" data-transition="none"><div class="content subsection incremental" ref="intro/slides/2">
<h1>About The Speaker</h1>

<ul>
<li>Staff Engineer SpringSource, VMware</li>
<li>Spring MVC, Spring Web Flow committer</li>
<li>Teach and consult, Spring Projects</li>
<li>Spring Web course author</li>
<li>NYC area</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content subsection bullets smaller" ref="config/slides/1">
<h1>Agenda</h1>

<ul>
<li><strong>Code-based Config</strong></li>
<li>@MVC Support Classes</li>
<li>Consumes &amp; Produces</li>
<li>URI Variables</li>
<li>Redirect Scenarios</li>
<li>UriComponentsBuilder</li>
<li>Multipart Requests</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="config/slides/2">
<h1>The MVC Namespace</h1>

<ul>
<li>Introduced in Spring 3.0</li>
<li>More opinionated than built-in defaults</li>
<li>Aims to simplify typical configuration</li>
</ul>


<p class="notes">A concise way to register: Interceptors, Converters, Formatters, Resource handling, View controllers, and more...</p></div>
</div><div class="slide" data-transition="none"><div class="content" ref="config/slides/3">
<h1>Example</h1>

<pre class="sh_xml"><code>
  &lt;mvc:annotation-driven /&gt;

  &lt;mvc:interceptors&gt;
      &lt;ref bean="log4jInterceptor"/&gt;
  &lt;/mvc:interceptors&gt;

  &lt;mvc:resources mapping="/resources/**" 
        location="/resources/" /&gt;

  &lt;mvc:default-servlet-handler /&gt;    </code></pre></div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="config/slides/4">
<h1>Ease-of-Use vs Control:</h1>

<h1>MVC Namespace</h1>

<p class="notes">Ask how many people use the namespace? Probably under 50% ...</p>

<ul>
<li>How do I see actual configuration?</li>
<li>How do I change bean property ... ?</li>
<li>No transparency</li>
<li>No path from simple to advanced</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="config/slides/5">
<h1>Spring MVC Java Config</h1>

<h2>(Spring 3.1)</h2>

<ul>
<li>Code-based alternative to namespace</li>
<li>Not a one-for-one "translation"</li>
<li>Match the benefits of the namespace</li>
<li>Address the shortcomings</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content smaller" ref="config/slides/6">
<h1>Basic MVC Java Config</h1>

<h1>Example</h1>

<pre class="sh_java"><code>
@EnableWebMvc
@Configuration
public class WebConfig extends WebMvcConfigurerAdapter {

  @Override
  public void addFormatters(FormatterRegistry reg){
      // ...
  }

  @Override
  public void addInterceptors(InterceptorRegistry reg){
      // Equivalent to &lt;mvc:interceptors&gt;
  }

  // Override more base class methods as needed...

}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content smaller" ref="config/slides/7">
<h1>Load Java config from web.xml</h1>

<pre class="sh_xml"><code>
  &lt;!-- Detect @Configuration classes in a package --&gt;

  &lt;context-param&gt;
    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
    &lt;param-value&gt;org.example.somepackage&lt;/param-value&gt;
  &lt;/context-param&gt;

  &lt;!-- Use ApplicationContext for Java config --&gt;

  &lt;context-param&gt;
    &lt;param-name&gt;contextClass&lt;/param-name&gt;
    &lt;param-value&gt;
        org.springframework.web.context.support.
          AnnotationConfigWebApplicationContext
    &lt;/param-value&gt;
  &lt;/context-param&gt;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="config/slides/8">
<h1>Why MVC Java Config?</h1>

<ul>
<li>Higher level configuration API</li>
<li>Like MVC namespace</li>
<li>But much easier to see underlying config</li>
<li>A path from simple to advanced</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content smaller" ref="config/slides/9">
<h1>Advanced Customization Example</h1>

<pre class="sh_java"><code>
@Configuration
public class WebConfig extends WebMvcConfigurationSupport {

  @Override
  public void addInterceptors(InterceptorRegistry reg){
    // Equivalent to &lt;mvc:interceptors&gt;
  }

  @Override
  @Bean
  public RequestMappingHandlerAdapter 
                requestMappingHandlerAdapter() {

      // Create or let "super" create and customize 
      // RequestMappingHandlerAdapter ...

  }
}</code></pre></div>
</div><div class="slide" data-transition="none">
  <div class="content code" ref="config/slides/10">
<h1>Demo</h1>

<p><a href="https://github.com/SpringSource/greenhouse"><strong>https://github.com/SpringSource/greenhouse</strong></a><br>
<em>See package:</em>
<a href="https://github.com/SpringSource/greenhouse/tree/master/src/main/java/com/springsource/greenhouse/config">com.springsource.greenhouse.config</a></br>

<p><a href="https://github.com/rstoyanchev/spring-mvc-31-demo"><strong>https://github.com/rstoyanchev/spring-mvc-31-demo</strong></a><br>
<em>See package:</em>
<a href="https://github.com/rstoyanchev/spring-mvc-31-demo/tree/master/src/main/java/org/springframework/samples/mvc31/config">org.springframework.samples.mvc31.config</a></br></p>
</p>
</div>
</div><div class="slide" data-transition="none">
  <div class="content" ref="config/slides/11">
<h2>For more on</h2>

<h2><strong>Spring MVC Java Config</strong></h2>

<h2>attend this session:</h2>

<br><br><br>


<h2><a href="http://www.springone2gx.com/conference/chicago/2011/10/session?id=24006"><strong>Configuration Enhancements in Spring 3.1</strong></a></h2>

<p>Wednesday, 12:45</p></br>
</br>
</br></div>
</div><div class="slide" data-transition="none"><div class="content subsection bullets smaller" ref="infrastructure/slides/1">
<h1>Agenda</h1>

<ul>
<li>Code-based Config</li>
<li><strong>@MVC Support Classes</strong></li>
<li>Consumes &amp; Produces</li>
<li>URI Variables</li>
<li>Redirect Scenarios</li>
<li>UriComponentsBuilder</li>
<li>Multipart Requests</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="infrastructure/slides/2">
<h1>@Controllers</h1>

<ul>
<li>Introduced in Spring 2.5</li>
<li>Expanded for REST in 3.0</li>
<li>Replaced controller class hierarchy</li>
<li>Overall <strong>very</strong> successful</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="infrastructure/slides/3">
<h1>@MVC Support Classes</h1>

<ul>
<li>Gradually evolved</li>
<li>Not very customizable</li>
<li>Many a JIRA request for flexibility</li>
<li>Hindered by some legacy design</li>
</ul>


<p class="notes">Duplicated handler method selection, can't split HTTP methods across controllers, etc.</p></div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="infrastructure/slides/4">
<h1>New, Spring 3.1</h1>

<h1>@MVC Support Classes</h1>

<ul>
<li><code>RequestMappingHandlerMapping</code></li>
<li><code>RequestMappingHandlerAdapter</code></li>
<li><code>ExceptionHandlerExceptionResolver</code></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="infrastructure/slides/5">
<p><img src="./file/infrastructure/support-classes.png" alt="support-classes.png"/></p></div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="infrastructure/slides/6">
<h1>@MVC Configuration</h1>

<ul>
<li><strong>New</strong> support classes "on"</li>
<li>... if using MVC namespace, Java config</li>
<li><strong>Old</strong> support classes still the default</li>
<li>... if not using namespace or Java config</li>
<li>... no support for new features</li>
</ul>


<p class="notes">Use of namespace is by choice and represents the recommended configuration</p></div>
</div><div class="slide" data-transition="none"><div class="content center" ref="infrastructure/slides/7">
<p><img src="./file/infrastructure/resolver-handler-implementations.png" alt="resolver-handler-implementations.png"/></p></div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="infrastructure/slides/8">
<h1><strong>HandlerMapping</strong> Customizations</h1>

<ul>
<li>Provide custom <code>RequestCondition</code></li>
<li>Build <code>RequestMappingInfo</code> from

<ul>
<li>custom annotations</li>
<li>anything (e.g. Groovy DSL)</li>
</ul>
</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="infrastructure/slides/9">
<h1><strong>HandlerAdapter</strong> Customizations</h1>

<ul>
<li>Custom argument &amp; return value types</li>
<li>Extend built-in argument resolvers</li>
<li>Extend built-in return value handlers</li>
<li>Design your own method signature</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content code" ref="infrastructure/slides/10">
<h1>Demo</h1>

<p><a href="https://github.com/rstoyanchev/spring-mvc-31-demo">https://github.com/rstoyanchev/spring-mvc-31-demo</a></p></div>
</div><div class="slide" data-transition="none"><div class="content subsection bullets smaller" ref="consumes-produces/slides/1">
<h1>Agenda</h1>

<ul>
<li>Code-based Config</li>
<li>@MVC Support Classes</li>
<li><strong>Consumes &amp; Produces</strong></li>
<li>URI Variables</li>
<li>Redirect Scenarios</li>
<li>UriComponentsBuilder</li>
<li>Multipart Requests</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental smaller" ref="consumes-produces/slides/2">
<h1>Consumes &amp; Produces</h1>

<h1>Conditions</h1>

<pre class="sh_java"><code>
    @RequestMapping(value="/path"
                    method=RequestMethod.POST, 
                    consumes="application/json")
    @ResponseBody
    public String save(@RequestBody JavaBean javaBean) {
        // ..
    }

    @RequestMapping(value="/path"
                    method=RequestMethod.GET, 
                    produces="application/json") 
    @ResponseBody
    public JavaBean get() {
        // ..
    }</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content incremental small" ref="consumes-produces/slides/3">
<h1>Media Type Header Conditions:</h1>

<h1>Auto-converted</h1>

<ul>
<li><code>headers="Content-Type=text/plain"</code>

<ul>
<li>becomes <code>consumes="text/plain"</code></li>
</ul>
</li>
<li><code>headers="Accept=text/plain"</code>

<ul>
<li>becomes <code>produces="text/plain"</code></li>
</ul>
</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental small" ref="consumes-produces/slides/4">
<h1>Consumes &amp; Produces</h1>

<h1>Semantics</h1>

<ul>
<li>Aligned with JAX-RS</li>
<li><code>produces</code> influences actual content type used</li>
<li>Possible to request more general media type</li>
<li>For example request for <code>"text/*"</code> or <code>"*/*"</code>
matches to <code>@RequestMapping(produces = "text/plain"</code>)</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content code" ref="consumes-produces/slides/5">
<h1>Demo</h1>

<p><a href="https://github.com/SpringSource/spring-mvc-showcase">https://github.com/SpringSource/spring-mvc-showcase</a></p>

<p><a href="https://github.com/SpringSource/spring-mvc-showcase/blob/master/src/main/java/org/springframework/samples/mvc/mapping/MappingController.java"><code>MappingController.java</code></a><br>
<a href="https://github.com/SpringSource/spring-mvc-showcase/blob/master/src/main/java/org/springframework/samples/mvc/response/ResponseController.java"><code>ResponseController.java</code></a></br></p>
</div>
</div><div class="slide" data-transition="none"><div class="content subsection bullets smaller" ref="uri-variables/slides/1">
<h1>Agenda</h1>

<ul>
<li>Code-based Config</li>
<li>@MVC Support Classes</li>
<li>Consumes &amp; Produces</li>
<li><strong>URI Variables</strong></li>
<li>Redirect Scenarios</li>
<li>UriComponentsBuilder</li>
<li>Multipart Requests</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content small" ref="uri-variables/slides/2">
<h1>URI Variables In</h1>

<h1>Data Binding</h1>

<pre class="sh_java"><code>

@RequestMapping(
    value="/people/{firstName}/{lastName}/SSN")

public void search(Person person) {

    // person.getFirstName() is populated
    // person.getLastName()  is populated

}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content small" ref="uri-variables/slides/3">
<h1>URI Variable</h1>

<h1>To Instantiate Model Attribute</h1>

<pre class="sh_java"><code>
  // 1. URI variable name = model attr name
  // 2. Registered Converter&lt;String, Account&gt;

  @RequestMapping(value="/{account}", 
                  method = RequestMethod.PUT)

  public String update(Account account) {

    // ...

  }</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content code" ref="uri-variables/slides/4">
<h1>Demo</h1>

<p><a href="https://github.com/rstoyanchev/spring-mvc-31-demo">https://github.com/rstoyanchev/spring-mvc-31-demo</a></p>

<p><strong>See package:</strong><br>
<a href="https://github.com/rstoyanchev/spring-mvc-31-demo/tree/master/src/main/java/org/springframework/samples/mvc31/crudcontroller"><code>org.springframework.samples.mvc31.crudcontroller</code></a></br></p>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="uri-variables/slides/5">
<h1>Path Variables</h1>

<h1>In Rendering</h1>

<ul>
<li>Path variables merged in the model</li>
<li>Prior to rendering</li>
<li>Individal <code>View</code> types can opt out

<ul>
<li><code>MappingJacksonJsonView</code></li>
<li><code>MarshallingView</code></li>
</ul>
</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content small" ref="uri-variables/slides/6">
<h1>Example</h1>

<pre class="sh_java"><code>

@RequestMapping("/develop/apps/edit/{slug}")

public String editForm(@PathVariable String slug){

    // No need to add "slug" to the model
    // It will be merged in the model

}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content smaller" ref="uri-variables/slides/7">
<h1>URI Variables</h1>

<h1>In Redirect Strings</h1>

<pre class="sh_java"><code>
    @RequestMapping(
        value="/{group}/{year}/{month}/{slug}/rooms",
        method=RequestMethod.POST)

    public String createRoom() {

        // No need to add "group"/"year"/.. to the model
        // Will be available for the redirect string

        return "redirect:/{group}/{year}/{month}/{slug}";
    }</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content subsection bullets smaller" ref="redirect/slides/1">
<h1>Agenda</h1>

<ul>
<li>Code-based Config</li>
<li>@MVC Support Classes</li>
<li>Consumes &amp; Produces</li>
<li>URI Variables</li>
<li><strong>Redirect Scenarios</strong></li>
<li>UriComponentsBuilder</li>
<li>Multipart Requests</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content small" ref="redirect/slides/2">
<h1>What will the redirect URL be?</h1>

<pre class="sh_java"><code>
@Controller
@SessionAttributes("foo")
public class SomeController {

    @ModelAttribute
    public void populate(Model model) {

        // ...
    }

    @RequestMapping("/path")
    public String save(Model model) {

        // ...

        return "redirect:/action";
    }
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="redirect/slides/3">
<h1>Answer:</h1>

<h2>(Up until Spring 3.1)</h2>

<ul>
<li>Depends on the content of the model</li>
<li>Simple type attrs appended to query</li>
<li>May lead to surprises</li>
</ul>


<p class="notes">Example surprises ROO-2158, SPR-6796</p></div>
</div><div class="slide" data-transition="none"><div class="content smaller" ref="redirect/slides/4">
<h1>What Usually Makes Sense ...</h1>

<pre class="sh_java"><code>
@RequestMapping("/path")
public String save(Foo foo, Errors errors, Model model) {

    if (errors.hasErrors()) {
      // Re-render using "default" model
      return "edit";
    }

    // 1. Clear the model content!

    model.asMap().clear()

    // 2. Add attributes for redirect

    return "redirect:/action";
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content smaller" ref="redirect/slides/5">
<h1>Spring 3.1 Redirect Example</h1>

<pre class="sh_java"><code>
    @RequestMapping("/path")
    public String save(Entity entity, Errors errors, 
                       RedirectAttributes redirectAttrs){

      if (errors.hasErrors()) {
        // Re-render form using "default" model
        return "edit"; 
      }

      // ...

      redirectAttrs.addAttribute("id", 123);
      redirectAttrs.addAttribute("date", new Date());

      return "redirect:/action/{id}";

    }</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="redirect/slides/6">
<h1><code>RedirectAttributes</code></h1>

<ul>
<li>Used <strong>only if</strong> controller redirects</li>
<li>Initially empty</li>
<li>Attributes formatted with DataBinder</li>
<li>Intended for use in redirect URL</li>
<li>... i.e. as URI vars or query params</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="redirect/slides/7">
<h1>Flash Attributes</h1>

<ul>
<li>Another kind of redirect attributes</li>
<li>But without impact on the URL</li>
<li>Temporily stored in the session</li>
<li>Removed immediately after the redirect</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content smaller" ref="redirect/slides/8">
<h1>Flash Attributes Example</h1>

<pre class="sh_java"><code>
  @RequestMapping("/path")
  public String save(Entity entity, Errors errors, 
                     RedirectAttributes redirectAttrs){

    if (errors.hasErrors()) {
      return "edit"; 
    }

    redirectAttrs.addFlashAttribute("message", "Success!");

    // Attribute "message" will appear in model of
    // the controller after the redirect

    return "redirect:/action";
  }</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content code" ref="redirect/slides/9">
<h1>Demo</h1>

<p><a href="https://github.com/SpringSource/spring-mvc-showcase">https://github.com/SpringSource/spring-mvc-showcase</a></p>

<p><a href="https://github.com/SpringSource/spring-mvc-showcase/blob/master/src/main/java/org/springframework/samples/mvc/form/FormController.java"><strong><code>FormController.java</code></strong></a></p></div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="redirect/slides/10">
<h1>Flash Attributes</h1>

<ul>
<li>Zero configuration required</li>
<li>Multi-tiered support</li>
<li>Use <code>RedirectAttributes</code> within @MVC</li>
<li>Or access <code>FlashMap</code> directly elsewhere</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content small" ref="redirect/slides/11">
<h1>Direct Access To FlashMap</h1>

<pre class="sh_java"><code>
// Some code not in @Controller
// Save attributes prior to a redirect..

FlashMap flashMap = 
  RequestContextUtils.getOutputFlashMap(request);

flashMap.put("message", "Success!");</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="redirect/slides/12">
<h1>Flash Attributes &amp;</h1>

<h1>Concurrency</h1>

<ul>
<li>A redirect is relatively short lived</li>
<li>Another async request may come in</li>
<li>E.g. polling, resource request, etc.</li>
<li>FlashMap may be consumed too early</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="redirect/slides/13">
<h1>Solution: Set Request Info</h1>

<h1>on FlashMap</h1>

<ul>
<li><code>setTargetRequestPath(String)</code></li>
<li><code>addTargetRequestParam(String,String)</code></li>
<li>Automatically done when using <code>"redirect:"</code> or <code>RedirectView</code></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content subsection bullets smaller" ref="uri-components-builder/slides/1">
<h1>Agenda</h1>

<ul>
<li>Code-based Config</li>
<li>@MVC Support Classes</li>
<li>Consumes &amp; Produces</li>
<li>URI Variables</li>
<li>Redirect Scenarios</li>
<li><strong>UriComponentsBuilder</strong></li>
<li>Multipart Requests</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="uri-components-builder/slides/2">
<h1>Building a URI</h1>

<ul>
<li><code>UriTemplate</code> the main option in Spring 3.0</li>
<li>Works but some challenges</li>
<li>Can not encode all URI components fully</li>
<li>Not very flexible</li>
</ul>


<p class="notes">SPR-8662, SPR-8403, path segments &amp; query params cannot be encoded fully</p></div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="uri-components-builder/slides/3">
<h1><code>UriComponents</code></h1>

<h2>(Spring 3.1)</h2>

<ul>
<li>A container for URI components</li>
<li>Created from String, templated values</li>
<li>Has expand and encode operations</li>
<li>Immutable</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content small incremental" ref="uri-components-builder/slides/4">
<h1><code>UriComponentsBuilder</code></h1>

<h2>(Spring 3.1)</h2>

<ul>
<li>A builder for UriComponents</li>
<li><em><code>UriComponentsBuilder.fromPath(String)</code></em></li>
<li>... with chained API methods</li>
<li><em><code>UriComponentsBuilder.fromUriString(String)</code></em></li>
<li>... equivalent to <code>new UriTemplate(String)</code></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content small" ref="uri-components-builder/slides/5">
<h1>Example: URI Components</h1>

<pre class="sh_java"><code>
    UriComponents uriComponents = 
        UriComponentsBuilder.fromPath("path")
            .queryParam("id", "A B")
            .fragment("a")
            .build()
            .encode();

    UriComponents uriComponents = 
        UriComponentsBuilder.fromPath("path")
            .query("id={id}")
            .fragment("a")
            .build()
            .expand("A B")
            .encode();</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content small" ref="uri-components-builder/slides/6">
<h1>Example: URI Template String</h1>

<pre class="sh_java"><code>
  UriComponents uriComponents = 
      UriComponentsBuilder
        .fromUriString("path?id={id}#a")
        .build()
        .expand("A B")
        .encode();

  MultiValueMap&lt;String, String&gt; queryMap = 
      uriComponents.getQueryParams();

  assertEquals("path", uriComponents.getPath();
  assertEquals("A%20B", queryMap.get("id"));
  assertEquals("a", uriComponents.getFragment();</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="uri-components-builder/slides/7">
<h1><code>UriTemplate &amp; UriUtils</code></h1>

<ul>
<li>Still available</li>
<li>Both delegate to <code>UriComponents</code> and <code>UriComponentsBuilder</code></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content small" ref="uri-components-builder/slides/8">
<h1>Redirect URLs</h1>

<h1>with <code>UriComponentsBuilder</code></h1>

<pre class="sh_java"><code>
@RequestMapping
public String handle() {

    // ...

  UriComponents redirectUri = 
      UriComponentsBuilder.fromPath("/path/{id}")
        .query("q={q}")
        .build()
        .expand("123", "q1")
        .encode();

  return "redirect:" + redirectUri.toUriString();
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content subsection bullets smaller" ref="multipart-requests/slides/1">
<h1>Agenda</h1>

<ul>
<li>Code-based Config</li>
<li>@MVC Support Classes</li>
<li>Consumes &amp; Produces</li>
<li>URI Variables</li>
<li>Redirect Scenarios</li>
<li>UriComponentsBuilder</li>
<li><strong>Multipart Requests</strong></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="multipart-requests/slides/2">
<h1>Servlet 3.0 Multipart</h1>

<h1>Request Parsing</h1>

<ul>
<li><code>StandardServletMultipartResolver</code></li>
<li>Use of above resolver is optional</li>
<li>Required only if using <code>MultipartFile</code></li>
<li>May use <code>javax.servlet.http.Part</code> instead</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental smaller" ref="multipart-requests/slides/3">
<h1>Multipart Request Examples</h1>

<pre class="sh_java"><code>
@RequestMapping(method = RequestMethod.POST)
public void create(
        @RequestParam("file") MultipartFile file){

    InputStream in = file.getInputStream();

    // ...
}


@RequestMapping(method = RequestMethod.POST)
public void create(
        @RequestParam("file") Part part){

    InputStream in = part.getInputStream();

    // ...
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="multipart-requests/slides/4">
<h1><code>@RequestPart</code></h1>

<ul>
<li>Like <code>@RequestBody</code> but targets the part of a <code>"multipart/form-data"</code> request</li>
<li>The body of the part is read with an <code>HttpMessageConverter</code></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content smaller" ref="multipart-requests/slides/5">
<h1>Request with</h1>

<h1><strong>JSON</strong> Part &amp; <strong>Binary File</strong> Part</h1>

<pre><code>POST /someUrl
Content-Type: multipart/mixed

--edt7Tfrdusa7r3lNQc79vXuhIIMlatb7PQg7Vp
Content-Disposition: form-data; name="meta-data"
Content-Type: application/json; charset=UTF-8
Content-Transfer-Encoding: 8bit

{
  "name": "value"
}
--edt7Tfrdusa7r3lNQc79vXuhIIMlatb7PQg7Vp
Content-Disposition: form-data; name="file"; filename="file.properties"
Content-Type: text/xml
Content-Transfer-Encoding: 8bit
... File Data ...
</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content smaller" ref="multipart-requests/slides/6">
<h1>Example: <code>@RequestPart</code></h1>

<pre class="sh_java"><code>

@RequestMapping(
    method = RequestMethod.POST, 
    consumes = { "multipart/form-data" })

public ResponseEntity&lt;Object&gt; void create(
        @RequestPart("json-data") @Valid JavaBean javaBean, 
        @RequestPart("file-data") MultipartFile file) {

   // ...

} </code></pre></div>
</div><div class="slide" data-transition="none"><div class="content incremental small" ref="multipart-requests/slides/7">
<h1><code>@Valid</code></h1>

<ul>
<li>Supported on <code>@RequestBody</code> and <code>@RequestPart</code> args</li>
<li>... <code>MethodArgumentNotValidException</code> on errors</li>
<li>Handled by <code>DefaultHandlerExceptionResolver</code></li>
<li>... <code>SC_BAD_REQUEST</code> (<code>400</code>) response  code</li>
</ul>
</div>
</div><div class="slide" data-transition="none">
  <div class="content subsection" ref="end/slides/1">
<h1>References</h1>

<p><strong>Documentation, Blogs</strong>:</p>

<p><a href="http://static.springsource.org/spring/docs/3.1.0.RC1/spring-framework-reference/html/new-in-3.1.html">What's New in Spring 3.1</a><br><br>
<a href="http://blog.springsource.com/2011/06/13/spring-3-1-m2-spring-mvc-enhancements-2/">
Spring 3.1 M2: Spring MVC Enhancements</a><br><br/>

<p><strong>Samples:</strong><br><br>
<a href="https://github.com/rstoyanchev/spring-mvc-31-demo">https://github.com/rstoyanchev/spring-mvc-31-demo</a><br><br>
<a href="https://github.com/SpringSource/spring-mvc-showcase">https://github.com/SpringSource/spring-mvc-showcase</a><br><br>
<a href="https://github.com/SpringSource/greenhouse">https://github.com/SpringSource/greenhouse</a><br><br/></br>
</br>
</br></br></br></br></br></p></br></br></br></p></div>
</div><div class="slide" data-transition="none">
  <div class="content subsection bullets" ref="end/slides/2">
<h1>Spring 3.1 Continued...</h1>

<br><br><br>


<p><em>Wednesday 12:45:</em> <br><br>
<a href="http://www.springone2gx.com/conference/chicago/2011/10/session?id=24006">Configuration Enhancements in Spring 3.1</a></br>

<br><br>


<p><em>Friday 10:15:</em><br><br>
<a href="http://www.springone2gx.com/conference/chicago/2011/10/session?id=24020">Spring 3.1 and MVC Testing Support</a><br><br/></br>
</br>
</br></p></br></br></br></p></br></br></br></div>
</div><div class="slide" data-transition="none"><div class="content subsection" ref="end/slides/3">
<h1>Questions?</h1></div>
</div><div class="slide" data-transition="none"><div class="content subsection" ref="end/slides/4">
<h1>Thank You!</h1></div>
</div></div>

</body>
</html>
